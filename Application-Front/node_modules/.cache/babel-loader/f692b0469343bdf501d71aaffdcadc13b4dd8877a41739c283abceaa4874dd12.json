{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\FiercePC\\\\Desktop\\\\VSCode\\\\Appli-EPRD_Drive_API\\\\application-front\\\\src\\\\Components\\\\LoginPage\\\\LoginPage.js\",\n  _s = $RefreshSig$();\nimport \"./LoginPage.css\";\n// Importation des bibliothèques nécessaires\nimport React, { useState } from \"react\";\nimport { useNavigate, UseEffect } from \"react-router-dom\";\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst LoginPage = () => {\n  _s();\n  const navigate = useNavigate();\n\n  // États pour stocker le nom d'utilisateur et le mot de passe, le token et les données\n  const [username, setUsername] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [token, setToken] = useState(null);\n  const [dataAPI, setDataAPI] = useState({});\n\n  // Fonction pour gérer la soumission du formulaire\n  const handleSubmit = async event => {\n    event.preventDefault();\n    //appel API pour le token\n    const response = await fetch(\"https://betadev.elphegeproisy.com/drive_API/login_check\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        username,\n        password\n      })\n    });\n    if (response.ok) {\n      const dataToken = await response.json();\n      setToken(dataToken.token);\n      localStorage.setItem(\"token\", dataToken.token);\n    } else {\n      console.log(\"Erreur de connexion\");\n    }\n    UseEffect(() => {\n      if (token) {\n        const fetchData = async () => {\n          try {\n            const response = await fetch(\"http://betadev.elphegeproisy.com/drive_API/user\", {\n              method: \"GET\",\n              headers: {\n                Authorization: `Bearer ${token}`,\n                // Envoye le token dans les headers\n                \"Content-Type\": \"application/json\"\n              }\n            });\n            if (!response.ok) {\n              // message d'erreur à changer\n              throw new Error(\"Erreur lors de la récupération des données utilisateur\");\n            }\n            const data = await response.json();\n            setDataAPI(data); // Stocker les données utilisateur\n            //  navigation choix entre la page admin ou la page user? fonction de ce que renvoie l'API\n            navigate(dataAPI.role[0] === \"ROLE_ADMIN\" ? \"/admin\" : `/user/${dataAPI.id}`, {\n              state: {\n                ...dataAPI\n              }\n            });\n          } catch (Error) {\n            console.log(\"erreur récupération de données \".Error);\n          }\n        };\n        fetchData();\n      }\n    }, [token]);\n\n    //  code en commentaire cidessous: dataTests pour l'app react avant la mise en place de l'API\n    // let data = {\n    //     // donnée qui sert à afficher le bon type de page (admin ou utilisateur?)\n    //     role: \"admin\",\n    //     // donnée qui est injectée dans l'URL (pourra éventuellement servir si il y a plusieurs administrateurs)\n    //     id_user: 1565,\n    //     // donnée que j'utilise pour afficher le nom de l'utilisateur qui s'est connecté (admin ou user)\n    //     username: \"Rémi\",\n    //     // donnée qui permet l'affichage de la partothèque (en mode admin ou user)  je récupère le titre pour l'affichage et l'ID pour la future MAJ des partothèques User par l'admin (en drag and drop)\n    //     collection: [\n    //         [\"Sakura\", 89],\n    //         [\"Olympic fanfare and theme\", 75],\n    //         [\"Ceremonial Hymn\", 18],\n    //         [\"Arsenal\", 32],\n    //         [\"The wind in the willows\", 54],\n    //     ],\n    //     // ces données servent pour l'affichage des contenus des partothèques \"utilisateurs\" sur la page admin (id_user ne servira que pour la MAJ des partothèques User par l'admin , l'objet complet est renvoyé et il faudra en extraire id-user pour le rajouter dans la table associative exemple rajouter un enregistrement id_user=3 et id_fichier=75) ce qui permettra de rajouter \"Olympic fanfare and theme\" à l'utilisateur Flavie dans cet exemple)\n    //     listUsers: [\n    //         {\n    //             name: \"Elphège\",\n    //             id_user: 1,\n    //             titres: [\n    //                 [\"Ceremonial Hymn\", 18],\n    //                 [\"Arsenal\", 32],\n    //                 [\"The wind in the willows\", 54],\n    //             ],\n    //         },\n    //         {\n    //             name: \"Magalie\",\n    //             id_user: 2,\n    //             titres: [\n    //                 [\"Olympic fanfare and theme\", 75],\n    //                 [\"Ceremonial Hymn\", 18],\n    //             ],\n    //         },\n    //         {\n    //             name: \"Flavie\",\n    //             id_user: 3,\n    //             titres: [],\n    //         },\n    //         {\n    //             name: \"MarieH\",\n    //             id_user: 4,\n    //             titres: [[\"The wind in the willows\", 54]],\n    //         },\n    //     ],\n    // };\n  };\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      className: \"conn\",\n      children: \"Application Partoth\\xE8que\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"containerConnex\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Connexion\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleSubmit,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"formGroup\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            htmlFor: \"username\",\n            children: \"Nom d'utilisateur\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 139,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            id: \"username\",\n            value: username,\n            onChange: e => setUsername(e.target.value),\n            required: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 140,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 138,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"formGroup\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            htmlFor: \"password\",\n            children: \"Mot de passe\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 149,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"password\",\n            id: \"password\",\n            value: password,\n            onChange: e => setPassword(e.target.value),\n            required: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 150,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 148,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btnLogin\",\n          type: \"submit\",\n          children: \"Se connecter\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 158,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true);\n};\n_s(LoginPage, \"Kb91zIwhJaZaR82hGJs5ngD70FA=\", false, function () {\n  return [useNavigate];\n});\n_c = LoginPage;\nexport default LoginPage;\nvar _c;\n$RefreshReg$(_c, \"LoginPage\");","map":{"version":3,"names":["React","useState","useNavigate","UseEffect","jsxDEV","_jsxDEV","Fragment","_Fragment","LoginPage","_s","navigate","username","setUsername","password","setPassword","token","setToken","dataAPI","setDataAPI","handleSubmit","event","preventDefault","response","fetch","method","headers","body","JSON","stringify","ok","dataToken","json","localStorage","setItem","console","log","fetchData","Authorization","Error","data","role","id","state","children","className","fileName","_jsxFileName","lineNumber","columnNumber","onSubmit","htmlFor","type","value","onChange","e","target","required","_c","$RefreshReg$"],"sources":["C:/Users/FiercePC/Desktop/VSCode/Appli-EPRD_Drive_API/application-front/src/Components/LoginPage/LoginPage.js"],"sourcesContent":["import \"./LoginPage.css\";\r\n// Importation des bibliothèques nécessaires\r\nimport React, { useState } from \"react\";\r\nimport { useNavigate, UseEffect } from \"react-router-dom\";\r\n\r\nconst LoginPage = () => {\r\n    const navigate = useNavigate();\r\n    \r\n    // États pour stocker le nom d'utilisateur et le mot de passe, le token et les données\r\n    const [username, setUsername] = useState(\"\");\r\n    const [password, setPassword] = useState(\"\");\r\n    const [token, setToken] = useState(null);\r\n    const [dataAPI, setDataAPI]= useState({})\r\n\r\n    // Fonction pour gérer la soumission du formulaire\r\n    const handleSubmit = async  (event) => {\r\n        event.preventDefault();\r\n        //appel API pour le token\r\n        const response = await fetch(\"https://betadev.elphegeproisy.com/drive_API/login_check\", {\r\n            method: \"POST\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n            },\r\n            body: JSON.stringify({ username, password }),\r\n        });\r\n\r\n        if (response.ok  ) {\r\n            const dataToken = await response.json();\r\n            setToken(dataToken.token);\r\n            localStorage.setItem(\"token\", dataToken.token);\r\n        \r\n        } else {\r\n            console.log(\"Erreur de connexion\");\r\n        }\r\n       \r\n         UseEffect(() => {\r\n             if (token) {\r\n                 const fetchData = async () => {\r\n                     try {\r\n                         const response = await fetch(\r\n                             \"http://betadev.elphegeproisy.com/drive_API/user\",\r\n                             {\r\n                                 method: \"GET\",\r\n                                 headers: {\r\n                                     Authorization: `Bearer ${token}`, // Envoye le token dans les headers\r\n                                     \"Content-Type\": \"application/json\",\r\n                                 },\r\n                             }\r\n                         );\r\n\r\n                         if (!response.ok) {\r\n                            // message d'erreur à changer\r\n                             throw new Error(\r\n                                 \"Erreur lors de la récupération des données utilisateur\"\r\n                             );\r\n                         }\r\n\r\n                         const data = await response.json();\r\n                         setDataAPI(data); // Stocker les données utilisateur\r\n                         //  navigation choix entre la page admin ou la page user? fonction de ce que renvoie l'API\r\n                         navigate(\r\n                             dataAPI.role[0] === \"ROLE_ADMIN\"\r\n                                 ? \"/admin\"\r\n                                 : `/user/${dataAPI.id}`,\r\n                             {\r\n                                 state: { ...dataAPI },\r\n                             }\r\n                         );\r\n                     } catch (Error) {\r\n                        console.log(\"erreur récupération de données \".Error);\r\n                     }\r\n                 };\r\n\r\n                 fetchData();\r\n             }\r\n         }, [token]);\r\n\r\n     \r\n\r\n        //  code en commentaire cidessous: dataTests pour l'app react avant la mise en place de l'API\r\n        // let data = {\r\n        //     // donnée qui sert à afficher le bon type de page (admin ou utilisateur?)\r\n        //     role: \"admin\",\r\n        //     // donnée qui est injectée dans l'URL (pourra éventuellement servir si il y a plusieurs administrateurs)\r\n        //     id_user: 1565,\r\n        //     // donnée que j'utilise pour afficher le nom de l'utilisateur qui s'est connecté (admin ou user)\r\n        //     username: \"Rémi\",\r\n        //     // donnée qui permet l'affichage de la partothèque (en mode admin ou user)  je récupère le titre pour l'affichage et l'ID pour la future MAJ des partothèques User par l'admin (en drag and drop)\r\n        //     collection: [\r\n        //         [\"Sakura\", 89],\r\n        //         [\"Olympic fanfare and theme\", 75],\r\n        //         [\"Ceremonial Hymn\", 18],\r\n        //         [\"Arsenal\", 32],\r\n        //         [\"The wind in the willows\", 54],\r\n        //     ],\r\n        //     // ces données servent pour l'affichage des contenus des partothèques \"utilisateurs\" sur la page admin (id_user ne servira que pour la MAJ des partothèques User par l'admin , l'objet complet est renvoyé et il faudra en extraire id-user pour le rajouter dans la table associative exemple rajouter un enregistrement id_user=3 et id_fichier=75) ce qui permettra de rajouter \"Olympic fanfare and theme\" à l'utilisateur Flavie dans cet exemple)\r\n        //     listUsers: [\r\n        //         {\r\n        //             name: \"Elphège\",\r\n        //             id_user: 1,\r\n        //             titres: [\r\n        //                 [\"Ceremonial Hymn\", 18],\r\n        //                 [\"Arsenal\", 32],\r\n        //                 [\"The wind in the willows\", 54],\r\n        //             ],\r\n        //         },\r\n        //         {\r\n        //             name: \"Magalie\",\r\n        //             id_user: 2,\r\n        //             titres: [\r\n        //                 [\"Olympic fanfare and theme\", 75],\r\n        //                 [\"Ceremonial Hymn\", 18],\r\n        //             ],\r\n        //         },\r\n        //         {\r\n        //             name: \"Flavie\",\r\n        //             id_user: 3,\r\n        //             titres: [],\r\n        //         },\r\n        //         {\r\n        //             name: \"MarieH\",\r\n        //             id_user: 4,\r\n        //             titres: [[\"The wind in the willows\", 54]],\r\n        //         },\r\n        //     ],\r\n        // };\r\n\r\n        \r\n       \r\n    };\r\n\r\n    return (\r\n        <>\r\n            <h1 className=\"conn\">Application Partothèque</h1>\r\n            <div className=\"containerConnex\">\r\n                <h2>Connexion</h2>\r\n                <form onSubmit={handleSubmit}>\r\n                    <div className=\"formGroup\">\r\n                        <label htmlFor=\"username\">Nom d'utilisateur</label>\r\n                        <input\r\n                            type=\"text\"\r\n                            id=\"username\"\r\n                            value={username}\r\n                            onChange={(e) => setUsername(e.target.value)}\r\n                            required\r\n                        />\r\n                    </div>\r\n                    <div className=\"formGroup\">\r\n                        <label htmlFor=\"password\">Mot de passe</label>\r\n                        <input\r\n                            type=\"password\"\r\n                            id=\"password\"\r\n                            value={password}\r\n                            onChange={(e) => setPassword(e.target.value)}\r\n                            required\r\n                        />\r\n                    </div>\r\n                    <button className=\"btnLogin\" type=\"submit\">Se connecter</button>\r\n                </form>\r\n            </div>\r\n        </>\r\n    );\r\n};\r\n\r\n\r\n\r\nexport default LoginPage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}